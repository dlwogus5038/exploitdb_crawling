from nltk.stem.porter import PorterStemmer
import jieba
import math
import sys
import os
import json
from pathlib import Path
import re

folder_name = ['Denial of Service & Proof of Concept Exploits', 'Exploit Shellcode Archive'
    , 'Local & Privilege Escalation Exploits', 'Remote Exploits', 'Web Application Exploits']
path = 'C:\\Users\\dlwog\\exploitdb_crawling\\exploitdb'

all_data = {}
for fold in folder_name:
    tmp_reader = {}
    file_list = os.listdir(path + '\\' + fold)

    tmp_list = []
    for file_name in file_list:
        if '.json' in file_name:
            tmp_list.append(file_name)

    all_data[fold] = []

    for tmp in tmp_list:
        print(tmp)

        tmp_str = ""
        with open(path + '\\' + fold + '\\' + tmp, 'r', encoding='utf-8-sig') as json_file:
            for line in json_file.readlines():
                if line == '}{\n':
                    tmp_str = tmp_str + '}ㅂ{'
                else:
                    tmpstring = re.sub('\n', '', line)
                    while (1):
                        if tmpstring[0] == ' ' or tmpstring[0] == '\xa0':
                            tmpstring = tmpstring[1:]
                        else:
                            break
                    tmp_str = tmp_str + tmpstring

        if tmp_str == "":
            continue

        new_list = tmp_str.split('ㅂ')
        for lis in new_list:
            all_data[fold].append(json.loads(lis))



with open(path + '\\' + 'exploitdb.json', 'w', encoding='utf-8') as json_file:
    json.dump(all_data, json_file, ensure_ascii=False)